<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>无纸化管理系统</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    @@include('url-config.html')
  </head>
  <body class="bg-info">

    <div class="layui-card layui-card-form">

      <div class="layui-card-body">

        <form class="ag-form layui-form"  ag-data-ctx="cfgmgr" ag-data-url="/cfg/seals/queryInit" ag-data-index='1' ag-form-callBack ="updateInitCall">
			
			<input type="hidden" id="seal_content" name="sealContent" value="" ag-verify="required" ag-verify-msg = "请选择图片！"/>
			<input type="hidden" name="isCmca"  />
			
            <div class="layui-inline ">
            	<label class="layui-form-label">印模名称：</label>
            	<div class="layui-input-block">
            		<input type="text" name="sealName"  ag-verify="required" autocomplete="off" placeholder="印模名称" class="layui-input">
            	</div>
            </div>
			<div class="layui-inline ">
				<label class="layui-form-label">印模类型：</label>
				<div class="layui-input-block">
					<select id="sealType" name="sealType"  ag-verify="required" class="layui-input"s>
					</select>
				</div>
			</div>
            <div class="layui-inline ">
            	<label class="layui-form-label">组织机构：</label>
            	<div class="layui-input-block">
            		<input type="hidden" name="groupIdStr" ag-verify="required"  autocomplete="off"  class="layui-input">
            		<input type="text" name="groupName" ag-tree-title="渠道选取" ag-verify="required"  autocomplete="off" placeholder="渠道" class="layui-input ag-data-tree"   ag-tree-parent-key="parentGroupId"  ag-tree-key="groupIdStr"   ag-tree-name="groupName" ag-tree-url="/sys/login/loadGroupTree" ag-tree-type="radio">
            		
            	</div>
            </div>	
            <div class="layui-inline ">
            	<label class="layui-form-label">印模高：</label>
            	<div class="layui-input-block">
            		<input type="text" name="sealHigh"  id="sealHigh" readonly="readonly" ag-verify="required" value=""  autocomplete="off" placeholder="印模高" class="layui-input">
            	</div>
            </div>
			<div class="layui-inline ">
				<label class="layui-form-label">印模宽：</label>
				<div class="layui-input-block">
					<input type="text" name="sealWidth" id="sealWidth" readonly="readonly" ag-verify="required" value="" autocomplete="off" placeholder="印模宽" class="layui-input">
				</div>
			</div>

        </form>


      </div>

      <div class="layui-card-footer">
		
		<button class=" layui-btn layui-btn-sm layui-btn-normal " onclick="SelectPic()" >
		  <i class="layui-icon layui-icon-picture-fine "></i>
		  <span class="btn-span-middle">选择图片</span>
		</button>
        <button class=" ag-btn-save  layui-btn layui-btn-sm layui-btn-normal " ag-data-ctx="cfgmgr" ag-data-url="/cfg/seals/add"  ag-data-index="1">
          <i class="layui-icon layui-icon-ok-circle "></i>
          <span class="btn-span-middle">提交</span>
        </button>
        <button class="ag-btn-cancel layui-btn layui-btn-sm layui-btn-normal">
          <i class="layui-icon layui-icon-close "></i>
          <span class="btn-span-middle">取消</span>
        </button>
      </div>

    </div>
  </body>
  
  <script>
	  
	  
	  function updateInitCall(data){
	  		  
	  				
			if($("1"==data.isCmca){
						  
				  var s = "<div>";
				  s += "<OBJECT style='display: none' ID='DLO' width=20px;height=20px CLASSID='CLSID:833DAB42-2C3D-4524-8C7E-26E4FF1EF859' CODEBASE='/static/js/ocx/downfileocx.cab#version=1,0,0,2' >";
				  s += "</OBJECT>";
				  s += "<OBJECT id='MakeSeal' height='200px' width='300px' classid='clsid:891FCEBB-6649-449A-A88D-E50756748EEE' codebase='/static/js/ocx/MakeSeal.ocx#version=1,0,0,4' >";
				  s += "</OBJECT></div>";
				  
					$(".ag-form").append(s);
					
			}else {
				
				var s = "<div>";
				s += "<OBJECT id='DMakeSealV61' classid='clsid:3F1A0364-AD32-4E2F-B550-14B878E2ECB1' VIEWASTEXT width=250 height=200 codebase='/static/js/ocx/MakeSealV6.cab#version=1,0,3,2' >"
				s +="     <PARAM NAME='_Version' VALUE='65536'> "
				s +="     <PARAM NAME='_ExtentX' VALUE='2646'> "
				s +="     <PARAM NAME='_ExtentY' VALUE='1323'> "
				s +="     <PARAM NAME='_StockProps' VALUE='0'> "
				s +=" </OBJECT></div>"
				$(".ag-form").append(s);
		
		}
	  }
	  
	  function SelectPic() {
		  
		  
		  
		  if ("0" == $("[name=isCmca]").val()) {
			  
			  SelBMPFile_onclick();
		  
		  } else {
			  
			  
			  if (!MakeSeal) {
			  					
					  util.error("请安装控件！");
					  
					  return false;
			  }
			  if (MakeSeal.DoOpenShow() == 0) {
				  $("#seal_content").val(MakeSeal.Base64Str());
				  $("#sealWidth").val(MakeSeal.SealWidth);
				  $("#sealHigh").val(MakeSeal.SealHeight);
			  }
		  }
	  }
	  
	   function SelBMPFile_onclick() {
		   
	          if (!DMakeSealV61) {
					
				  util.error("请安装控件！");
				  return false;
	          }
			  
	          if (0 != DMakeSealV61.SelectBmpFile()) {
	           
				  return false;
	          }
			  
	          var vBmpHeightMM = parseInt(DMakeSealV61.fBmpHeightMM * 100) / 100;
	          
			  var vBmpWidthMM = parseInt(DMakeSealV61.fBmpWidthMM * 100) / 100;
	          
			  if (vBmpHeightMM == 0 || vBmpWidthMM == 0) {
	              util.error("图片错误");
	              return false;
	          }
	          //设置印模大小
	          $("#sealWidth").val(vBmpWidthMM);
	          $("#sealHigh").val(vBmpHeightMM);
	          if (DMakeSealV61.GetEncBmp() == "") {
				  
	              util.error("请选择图片!");
	              
				  return false;
	          } 
			  
	          $("#seal_content").val(DMakeSealV61.GetEncBmp());
	      }
  </script>

</html>
